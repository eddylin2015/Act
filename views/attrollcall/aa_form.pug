extends ./base.pug
block content 
  h3= `${al_id} ${fn}`
  style.
    input{color:black}
    input[type="text"] {
      border:0
    }
    input[type="checkbox"] {
      border: 1px solid #a9a9a9;
      border-radius: .25em;
      width: 1.5em;
      height: 1.5em;
    }
  script.
    function fmt_time() {
       let d = new Date(), Y = d.getFullYear(), M = d.getMonth() + 1, D = d.getDate();
       let HH = d.getHours(), MM = d.getMinutes(), SS = d.getSeconds(), MS = d.getMilliseconds();
       //return Y + '' + (M < 10 ? "0" + M : M) + '' + (D < 10 ? "0" + D : D) + "" + (HH < 10 ? '0' + HH : HH) + "" + (MM < 10 ? "0" + MM : MM) //+ ":" + SS +":" + MS;
       return  (HH < 10 ? '0' + HH : HH) + "：" + (MM < 10 ? "0" + MM : MM) 
    }
    function rollcallAll(){
      $("form input:checkbox").each(function () { 
        
        if(this.id.startsWith("id"))
        {
           let aaid=this.id.split("_")[1]
           let leave=document.getElementById("leave_"+aaid).checked
           let rollcall=document.getElementById("rollcall_"+aaid).checked
           let miss=document.getElementById("miss_"+aaid).checked
           if(leave || rollcall || miss)
           {
           }else
           {
             document.getElementById("rollcall_"+aaid).checked=true
             document.getElementById("id_"+aaid).checked=true
           }
        }
        //if (this.checked == true) this.checked = false;  else  this.checked = true; 
      }); 
      //for (i = 0; i < myStud_Cnt; i++)
      //    if (typeof $('input[name=up_' + myStud[i] + ']:checked').val() != 'undefined')
      //    { } else { $('#up_' + myStud[i] + '1').attr('checked', 'checked'); }
    }
    function reset_row(aaid,a){
      var x = document.getElementById("id_"+aaid);
      if(!x.checked) {
        if(document.getElementById("leave_"+aaid).checked) document.getElementById("leave_"+aaid).checked=false
        if(document.getElementById("rollcall_"+aaid).checked) document.getElementById("rollcall_"+aaid).checked=false
        if(document.getElementById("miss_"+aaid).checked) document.getElementById("miss_"+aaid).checked=false
      }
    }
    function intime(aaid,a){
      var x = document.getElementById("id_"+aaid);
      x.checked = true;
      let nullcnt=0
      for(o of ["leave_","rollcall_","miss_"])
      {
         let temp_ = document.getElementById(o+aaid);
         console.log(temp_.id,a.id)
         if(temp_.id == a.id && temp_.checked){
           if(a.id.startsWith("leave_")) document.getElementById("va_"+aaid).value=1
           if(a.id.startsWith("rollcall_")) document.getElementById("va_"+aaid).value=2
           if(a.id.startsWith("miss_")) document.getElementById("va_"+aaid).value=4
         }else{
           temp_.checked = false;
           nullcnt++;
         }
      }
      if(nullcnt==3) document.getElementById("va_"+aaid).value=0;
    }
    function outtime(x,a){
      var x = document.getElementById("out_time_"+x);
      x.value=fmt_time()
    }
  form(method="POST", enctype="multipart/form-data")
    table.table 
      tr 
        td 更新
        td &nbsp;Name
        td &nbsp;
        td 
          a(onclick="rollcallAll();") 報到_A
        td &nbsp; 
      for book in books
        tr
          td
            input(type="checkbox", id=`id_${book.aa_id}`,onclick=`reset_row(${book.aa_id},this)` )     
            input(type="hidden",id=`va_${book.aa_id}`,size=1,readonly,disabled) 
          td  
            span= book.c_name
            br
            span= book.classno
            span 	&nbsp;
            span= book.seat 
          td
            .form-group
              label(for="title",style="width:20px") 請假
              input(type="checkbox",name= (`rollcall_${book.aa_id}`), id= (`leave_${book.aa_id}`), value=1, checked= ( book.rollcall == 1 ? true : false ),onclick=`intime(${book.aa_id},this)` )
          td  
            .form-group
              label(for="title",style="width:20px") 報到
              input(type="checkbox", name= (`rollcall_${book.aa_id}`),id= (`rollcall_${book.aa_id}`), value=2,checked= ( book.rollcall == 2 ? true : false ),onclick=`intime(${book.aa_id},this)` )
          td  
            .form-group
              label(for="title",style="width:20px") 失踪
              input(type="checkbox", name= (`rollcall_${book.aa_id}`),id= (`miss_${book.aa_id}`), value= 4,checked= ( book.rollcall == 4 ? true : false ),onclick=`intime(${book.aa_id},this)` )
      tr             
        td
          .form-group
            label(for="title",style="width:20px") 報到
            input(type="checkbox", name= (`rollcall_${rollcall_by}`),id= (`rollcall_${rollcall_by}`), value=2,checked= true )

    button.btn.btn-success(type="submit") Save
    if !books.length
      p No activity course found.

  

